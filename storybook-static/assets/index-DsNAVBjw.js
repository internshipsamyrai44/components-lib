import{r as i}from"./index-BYqfdl9-.js";import{r as g}from"./index-BQLUQhrt.js";import{u as O}from"./index-Dc00g9Il.js";import{u as A}from"./index-Dks5pEMs.js";function E(n,e){return i.useReducer((t,o)=>e[t][o]??t,n)}var M=n=>{const{present:e,children:t}=n,o=y(e),a=typeof t=="function"?t({present:o.isPresent}):i.Children.only(t),u=O(o.ref,P(a));return typeof t=="function"||o.isPresent?i.cloneElement(a,{ref:u}):null};M.displayName="Presence";function y(n){const[e,t]=i.useState(),o=i.useRef({}),a=i.useRef(n),u=i.useRef("none"),p=n?"mounted":"unmounted",[N,s]=E(p,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return i.useEffect(()=>{const r=d(o.current);u.current=N==="mounted"?r:"none"},[N]),A(()=>{const r=o.current,c=a.current;if(c!==n){const l=u.current,f=d(r);n?s("MOUNT"):f==="none"||r?.display==="none"?s("UNMOUNT"):s(c&&l!==f?"ANIMATION_OUT":"UNMOUNT"),a.current=n}},[n,s]),A(()=>{if(e){const r=m=>{const f=d(o.current).includes(m.animationName);m.target===e&&f&&g.flushSync(()=>s("ANIMATION_END"))},c=m=>{m.target===e&&(u.current=d(o.current))};return e.addEventListener("animationstart",c),e.addEventListener("animationcancel",r),e.addEventListener("animationend",r),()=>{e.removeEventListener("animationstart",c),e.removeEventListener("animationcancel",r),e.removeEventListener("animationend",r)}}else s("ANIMATION_END")},[e,s]),{isPresent:["mounted","unmountSuspended"].includes(N),ref:i.useCallback(r=>{r&&(o.current=getComputedStyle(r)),t(r)},[])}}function d(n){return n?.animationName||"none"}function P(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}export{M as P};
